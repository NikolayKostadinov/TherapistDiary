<!-- Loading състояние -->
@if (isLoading()) {
<div class="loading-container">
    <app-spinner />
</div>
}

<!-- Error състояние -->
@if (hasError() && !isLoading()) {
<div class="error-container">
    <div class="error-message">
        <h3>Възникна грешка</h3>
        <p>{{ errorMessage() }}</p>
        <div class="error-actions">
            <button class="retry-btn" (click)="onRetryLoadProfile()">
                Опитай отново
            </button>
            <button class="clear-btn" (click)="onClearError()">
                Затвори
            </button>
        </div>
    </div>
</div>
}

<!-- Success състояние - профилът е зареден -->
@if (userProfile() && !isLoading() && !hasError()) {
<div class="container-fluid service">
    <div class="container py-5">
        <div class="section-title mb-5" appScrollAnimation animationType="fadeInDown" [animationDelay]="200">
            <div class="sub-style">
                <h4 class="sub-title px-3 mb-0">Потребителски профил</h4>
            </div>
            <h1 class="display-3 mb-4">{{userProfile()?.fullName}}</h1>
        </div>

        <div class="details" appScrollAnimation animationType="fadeInUp" [animationDelay]="200">
            <div class="row g-4">
                <div class="col-3">
                    @if (userProfile()?.profilePictureUrl) {
                    <img [src]="userProfile()?.profilePictureUrl" alt="Profile Picture" class="profile-picture" />
                    } @else {
                    <img src="img/no-profile.jpg" alt="Profile Picture" class="profile-picture">
                    }
                </div>
                <div class="col-9">
                    @if(!userProfile()?.midName){
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <h5 class="form-label">
                                    <i class="fa fa-check text-primary me-2"></i>Име
                                </h5>
                                <p class="property-content">{{userProfile()?.firstName}}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <h5 class="form-label">
                                    <i class="fa fa-check text-primary me-2"></i>Фамилия
                                </h5>
                                <p class="property-content">{{userProfile()?.lastName}}</p>
                            </div>
                        </div>
                    </div>
                    } @else{
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <h5 class="form-label">
                                    <i class="fa fa-check text-primary me-2"></i>Име
                                </h5>
                                <p class="property-content">{{userProfile()?.firstName}}</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <h5 class="form-label">
                                    <i class="fa fa-check text-primary me-2"></i>Презиме
                                </h5>
                                <p class="property-content">{{userProfile()?.midName}}</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <h5 class="form-label">
                                    <i class="fa fa-check text-primary me-2"></i>Фамилия
                                </h5>
                                <p class="property-content">{{userProfile()?.lastName}}</p>
                            </div>
                        </div>
                    </div>
                    }

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <h5 class="form-label">
                                    <i class="fa fa-check text-primary me-2"></i>Потребителско име
                                </h5>
                                <p class="property-content">{{userProfile()?.userName}}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <h5 class="form-label">
                                    <i class="fa fa-check text-primary me-2"></i>Електронна поща
                                </h5>
                                <p class="property-content">{{userProfile()?.email}}</p>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <h5 class="form-label">
                                    <i class="fa fa-check text-primary me-2"></i>Телефон
                                </h5>
                                <p class="property-content">{{userProfile()?.phoneNumber}}</p>
                            </div>
                        </div>
                        @if(userProfile()?.specialty){
                        <div class="col-md-6">
                            <div class="mb-3">
                                <h5 class="form-label">

                                    <i class="fa fa-check text-primary me-2"></i>Специалност

                                </h5>
                                <p class="property-content">{{userProfile()?.specialty}}</p>
                            </div>
                        </div>
                        }
                    </div>

                    @if(userProfile()?.biography){
                    <div class="row g-4">
                        <div class="mb-4">
                            <h5 class="form-label mb-3">

                                <i class="fa fa-check text-primary me-2"></i> Биографични данни

                            </h5>
                            <p class="mb-0 bio-text">{{userProfile()?.biography}}.</p>
                        </div>
                    </div>
                    }
                </div>
            </div>
            <div class="command-buttons">
                <button class="btn btn-primary rounded-pill text-white py-2 px-4" routerLink="edit"><i
                        class="fas fa-edit"></i>
                    Редакция</button>
                <button class="btn btn-danger rounded-pill text-white py-2 px-4" (click)="onDeleteClick()"><i
                        class="far fa-trash-alt"></i>
                    Изтриване</button>
            </div>
        </div>
    </div>
</div>
}

<!-- Fallback - ако няма профил, няма loading и няма error -->
@if (!userProfile() && !isLoading() && !hasError()) {
<div class="no-profile">
    <p>Няма данни за профила.</p>
    <button (click)="onRetryLoadProfile()">Зареди профила</button>
</div>
}

<!-- Модал за потвърждение на изтриване -->
<app-confirmation-modal [isVisible]="showDeleteModal()" title="Изтриване на профил"
    message="Сигурни ли сте, че искате да изтриете профила си?"
    warningText="Това действие е необратимо! Всички ваши данни ще бъдат изтрити завинаги." confirmText="Изтрий профила"
    cancelText="Отказ" (confirm)="onConfirmDelete()" (cancel)="onCancelDelete()">
</app-confirmation-modal>
<div class="container change-password-container">
    <div class="row justify-content-center">
        <div class="change-password-header">
            <h1>Смяна на парола</h1>
            <p>Сменете паролата си в Хармония</p>
        </div>
    </div>

    <!-- General Error Message -->
    @if (generalError()) {
    <div class="alert alert-danger"
         role="alert">
        <i class="fas fa-exclamation-triangle me-2"></i>
        {{ generalError() }}
    </div>
    }

    <form [formGroup]="form"
          (ngSubmit)="onSubmit()">

        <!-- Current Password -->
        <div class="form mb-3">
            <div class="form-group">
                <label for="currentPassword"
                       class="form-label">
                    <i class="fas fa-lock me-2"></i> Текуща парола
                </label>
                <div class="input-group">
                    <input type="{{ showCurrentPassword ? 'text' : 'password' }}"
                           class="form-control"
                           [class.is-invalid]="getFieldError('currentPassword')"
                           id="currentPassword"
                           formControlName="currentPassword"
                           placeholder="Текуща парола">
                    <div class="invalid-feedback">
                        {{ getFieldError('currentPassword') }}
                    </div>
                    <div class="input-group-append" [class.is-invalid]="getFieldError('currentPassword')">
                        <button type="button"
                                class="btn btn-light position-absolute end-0 top-50 translate-middle-y me-3 p-0 show-hide-password-btn"
                                tabindex="-1"
                                (click)="togglePasswordVisibility('current')">
                            <i class="fas"
                               [class.fa-eye]="!showCurrentPassword"
                               [class.fa-eye-slash]="showCurrentPassword"></i>
                        </button>
                    </div>
                </div>

            </div>

            <!-- New Password -->
            <div class="form-group">
                <label for="currentPassword"
                       class="form-label">
                    <i class="fas fa-lock me-2"></i> Нова парола
                </label>
                <div class="input-group">
                    <input type="{{ showNewPassword ? 'text' : 'password' }}"
                           class="form-control"
                           [class.is-invalid]="getFieldError('newPassword')"
                           id="newPassword"
                           formControlName="newPassword"
                           placeholder="Нова парола">
                    <div class="invalid-feedback">
                        {{ getFieldError('newPassword') }}
                    </div>
                    <div class="input-group-append" [class.is-invalid]="getFieldError('newPassword')">
                        <button type="button"
                                class="btn btn-light position-absolute end-0 top-50 translate-middle-y me-3 p-0 show-hide-password-btn"
                                tabindex="-1"
                                (click)="togglePasswordVisibility('new')">
                            <i class="fas"
                               [class.fa-eye]="!showNewPassword"
                               [class.fa-eye-slash]="showNewPassword"></i>
                        </button>
                    </div>
                </div>

            </div>

            <!-- Confirm Password -->
            <div class="form-group">
                <label for="confirmPassword"
                       class="form-label">
                    <i class="fas fa-lock me-2"></i> Потвърдете новата парола
                </label>
                <div class="input-group">
                    <input type="{{ showConfirmPassword ? 'text' : 'password' }}"
                           class="form-control"
                           [class.is-invalid]="getFieldError('confirmPassword')"
                           id="confirmPassword"
                           formControlName="confirmPassword"
                           placeholder="Потвърдете новата парола">
                    <div class="invalid-feedback">
                        {{ getFieldError('confirmPassword') }}
                    </div>
                    <div class="input-group-append" [class.is-invalid]="getFieldError('confirmPassword')">
                        <button type="button"
                                class="btn btn-light position-absolute end-0 top-50 translate-middle-y me-3 p-0 show-hide-password-btn"
                                tabindex="-1"
                                (click)="togglePasswordVisibility('confirm')">
                            <i class="fas"
                               [class.fa-eye]="!showConfirmPassword"
                               [class.fa-eye-slash]="showConfirmPassword"></i>
                        </button>
                    </div>
                </div>

            </div>
        </div>

        <!-- Action Buttons -->
        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
            <button type="submit"
                    class="btn btn-primary rounded-pill text-white py-2 px-4 flex-wrap flex-sm-shrink-0"
                    [disabled]="form.invalid || isLoading()">
                @if (isLoading()) {
                <span class="spinner-border spinner-border-sm me-2"
                      role="status"
                      aria-hidden="true"></span>
                Сменя...
                } @else {
                <i class="fas fa-save me-2"></i>
                Смени паролата
                }
            </button>
            <button type="button"
                    class="btn btn-danger rounded-pill text-white py-2 px-4 flex-wrap flex-sm-shrink-0"
                    (click)="onCancel()"
                    [disabled]="isLoading()">
                <i class="fas fa-times me-2"></i>
                Отказ
            </button>
        </div>
    </form>
    <!-- Password Requirements Info -->
    <div class="card mt-4 border-info">
        <div class="card-body">
            <h6 class="card-title text-info">
                <i class="fas fa-info-circle me-2"></i>
                Изисквания за паролата
            </h6>
            <ul class="list-unstyled mb-0 small">
                <li><i class="fas fa-check text-success me-2"></i>Минимум 8
                    символа</li>
                <li><i class="fas fa-check text-success me-2"></i>Изисква се
                    използването на
                    малки и
                    главни букви</li>
                <li><i class="fas fa-check text-success me-2"></i>Изисква се
                    използването на
                    цифри и
                    специални символи</li>
            </ul>
        </div>
    </div>
</div>
<td>{{ index }}</td>
<td>
    <strong>{{ appointment.date | date:'dd/MM/yyyy' }}</strong>
</td>
<td>
    <span class="text-muted">{{ appointment | appointmentTime }}</span>
</td>
<td>
    <div class="d-flex align-items-center">
        <div class="rounded-circle bg-primary d-flex align-items-center justify-content-center me-2"
             style="width: 32px; height: 32px; color: white; font-size: 14px;">
            {{ appointment.therapistFullName.charAt(0) || 'T' }}
        </div>
        <span>{{ appointment.therapistFullName || 'Неизвестен терапевт'
            }}</span>
    </div>
</td>
<td>{{ appointment.therapyName || 'Не е зададен тип' }}</td>
<td>
    @if (!isEditingNotes()) {
    @if (appointment.notes) {
    <div class="d-flex align-items-center justify-content-between">
        <span class="text-muted notes-text" [title]="appointment.notes">
            {{ appointment.notes.length > 50 ? (appointment.notes | slice:0:50)
            + '...' : appointment.notes }}
        </span>
        <button type="button" class="btn btn-sm btn-outline-primary ms-2" (click)="startEditingNotes()"
                title="Редактирай бележки">
            <i class="fas fa-edit"></i>
        </button>
    </div>
    } @else {
    <div class="d-flex align-items-center justify-content-between">
        <em class="text-muted">Няма бележки</em>
        <button type="button" class="btn btn-sm btn-outline-primary ms-2" (click)="startEditingNotes()"
                title="Добави бележки">
            <i class="fas fa-plus"></i>
        </button>
    </div>
    }
    } @else {
    <div class="notes-edit-container">
        <form [formGroup]="form" (ngSubmit)="saveNotes()">
            <textarea class="form-control form-control-sm mb-2" formControlName="notes"
                      placeholder="Въведете бележки..." rows="2" maxlength="500"
                      [class.is-invalid]="notesControlIsInvalid">
                </textarea>

            @if (getFieldError('notes')) {
            <div class="invalid-feedback d-block">
                {{ getFieldError('notes') }}
            </div>
            }

            <div class="d-flex gap-1">
                <button type="submit" class="btn btn-sm btn-primary text-white" [disabled]="form.invalid"
                        title="Запази">
                    <i class="fas fa-check"></i>
                </button>
                <button type="button" class="btn btn-sm btn-outline-danger" (click)="cancelEditingNotes()"
                        title="Отмени">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </form>
    </div>
    }
</td>
<td>
    <button type="button" class="btn btn-sm btn-outline-danger" (click)="deleteElement()" title="Отмени часа">
        <i class="fas fa-times"></i>
    </button>
</td>
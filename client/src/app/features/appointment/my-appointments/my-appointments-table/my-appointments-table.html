<div class="container-fluid mt-4 mb-3 mx-auto">
    <div class="row justify-content-center">
        <div class="col-12">
            <div class="common-container">
                <div class="common-header">
                    <h1>Моите записани часове</h1>
                    <p>Преглед и управление на вашите записани терапевтични
                        сесии</p>
                </div>

                <!-- Search Section -->
                <div class="row g-3 align-items-center">
                    <div class="col-md-6 search-wrapper">
                        <div class="input-group">
                            <span class="input-group-text">
                                <i class="fas fa-search"></i>
                            </span>
                            <input type="text" class="form-control search-input" [value]="searchTerm() || ''"
                                   (input)="onSearchInput($event)" placeholder="Търсене по терапевт, дата..."
                                   aria-label="Търсене на записани часове">
                            @if (searchTerm()) {
                            <button type="button" class="btn btn-outline-danger btn-clear" (click)="onSearch('')"
                                    title="Изчисти търсенето">
                                <i class="fas fa-times"></i>
                            </button>
                            }
                        </div>
                    </div>
                    <div class="col-md-4">
                        @if (searchTerm()) {
                        <small class="text-muted">
                            Търсене за: "<strong>{{ searchTerm() }}</strong>"
                        </small>
                        }
                    </div>
                </div>

                <!-- Loading Indicator -->
                @if (isLoading()) {
                <div class="d-flex justify-content-center my-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Зареждане...</span>
                    </div>
                </div>
                }

                <!-- Table Section -->
                @if (!isLoading()) {
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col" class="sortable-header" (click)="onSort('appointmentDate')"
                                style="cursor: pointer;">
                                Дата
                                <i [class]="getSortIcon('appointmentDate')"></i>
                            </th>
                            <th scope="col">Час</th>
                            <th scope="col" class="sortable-header" (click)="onSort('therapistName')"
                                style="cursor: pointer;">
                                Терапевт
                                <i [class]="getSortIcon('therapistName')"></i>
                            </th>
                            <th scope="col" class="sortable-header" (click)="onSort('therapyName')"
                                style="cursor: pointer;">
                                Тип терапия
                                <i [class]="getSortIcon('therapyName')"></i>
                            </th>
                            <th scope="col">Бележки</th>
                            <th scope="col"></th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (appointments().length === 0) {
                        <tr>
                            <td colspan="7" class="text-center py-4">
                                <i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
                                <p class="text-muted mb-0">
                                    @if (searchTerm()) {
                                    Няма намерени записани часове за търсенето
                                    "{{ searchTerm() }}"
                                    } @else {
                                    Все още нямате записани часове
                                    }
                                </p>
                            </td>
                        </tr>
                        } @else {
                        @for (appointment of appointments(); track
                        appointment.id; let i = $index) {
                        <tr app-my-appointments-row [appointment]="appointment"
                            [index]="pageOffset() + i + 1" (delete)="onDeleteClick($event)"
                            (updateNotes)="onUpdateNotes($event)">
                        </tr>
                        }
                        }
                    </tbody>
                </table>
                }

                <!-- Pagination -->
                @if (!isLoading() && pagerData()) {
                <app-pager [pager]="pagerData()" (pageChange)="onPageChange($event)"
                           (pageSizeChange)="onPageSizeChange($event)">
                </app-pager>
                }
            </div>
        </div>
    </div>
</div>

<!-- Модал за потвърждение на изтриване -->
<app-confirmation-modal [isVisible]="showDeleteModal()" title="Отмяна на час"
                        message="Сигурни ли сте, че искате да отмените часа си?"
                        warningText="Това действие е необратимо! Всички данни за часа ще бъдат изтрити завинаги."
                        confirmText="Отмени часа" cancelText="Отказ" (confirm)="onConfirmDelete()"
                        (cancel)="onCancelDelete()">
</app-confirmation-modal>